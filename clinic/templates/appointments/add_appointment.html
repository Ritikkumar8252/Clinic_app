{% extends "base.html" %}
{% block body %}

<!-- TOP HEADER (YELLOW BAR) -->
<div class="top-banner">
    <div>
        <h2>Dr. {{ session['user'] }}</h2>
        <p>Book a new appointment</p>
    </div>

    <div class="right-buttons">
        <a href="{{ url_for('appointments_bp.appointments') }}" class="btn-secondary">
            Back to Appointments
        </a>
    </div>
</div>

<!-- FORM CARD -->
<div class="form-card">
    <h2 class="form-title">Add Appointment</h2>

    <form method="POST">
        <div class="add-new-patient-box">
            <p>Can't find the patient?</p>
            <a href="{{ url_for('patients_bp.add_patient', from_page='add_appointment') }}" 
            class="btn-small btn-green">
                + Add New Patient
            </a>
        </div>

        <label>Select Patient</label>
        <select id="patientSelect" name="patient_id" class="input-box" required>
            <option value="">Search patient by name or phoneâ€¦</option>
            {% for p in patients %}
            <option value="{{ p.id }}">{{ p.name }} - ({{ p.phone }})</option>
            {% endfor %}
        </select>

        <label>Visit Type</label>
        <select name="type" class="input-box">
            <option value="First Visit">First Visit</option>
            <option value="Follow-up">Follow-up</option>
            <option value="Emergency">Emergency</option>
        </select>

        <label>Date</label>
        <input type="date" name="date" class="input-box" required>

        <label>Time</label>
        <input type="time" name="time" class="input-box" required>

        <button type="submit" class="btn-primary full-btn">Book Appointment</button>

    </form>
</div>
<script>
// Custom matcher: enables searching ANY part of text
function matchCustom(params, data) {
    if ($.trim(params.term) === '') {
        return data;
    }

    if (typeof data.text === 'undefined') {
        return null;
    }

    // Case-insensitive search for ANY part of the name or phone
    if (data.text.toLowerCase().indexOf(params.term.toLowerCase()) > -1) {
        return data;
    }

    return null;
}

$(document).ready(function() {
    $('#patientSelect').select2({
        placeholder: "Search patient by name or phone",
        allowClear: true,
        width: '100%',
        matcher: matchCustom
    });
});
</script>



{% endblock %}
