{% extends "base.html" %}
{% block body %}
<style>
/* ===== Patients page: app-like behavior ===== */

/* Disable text selection on patient UI */
.top-banner,
.top-banner *,

.controls-bar,
.controls-bar *,

.table-container,
.table-container *,

.patients-table,
.patients-table * {
    user-select: none;
    cursor: default;
}


/* Patient row hover (nice polish) */
.patients-table tbody tr:hover {
    background: #f9fafb;
}

/* Enable pointer for actions */
a,
.btn-view,
.btn-upload,
.btn-cert,
.btn-add {
    cursor: pointer;
    user-select: none;
}

/* Keep search & date inputs usable */
.search-box,
.date-box,
input {
    user-select: text;
    cursor: text;
}

/* Images should not be selectable */
.patient-mini {
    user-select: none;
    pointer-events: none;
}

</style>
<h1 class="page-title">Patients</h1>

<!-- TOP DOCTOR HEADER -->
<div class="top-banner light-orange">
    <div>
        <h2 class="doctor-title">Dr. {{ session['user_email'] }}</h2>
        <p class="subtitle">Manage all patient records in one place</p>
    </div>

    <div class="right-buttons">
        <a href="{{ url_for('patients_bp.add_patient') }}" class="btn-add">
            + Add New Patient
        </a>
    </div>
</div>

<!-- FILTER BAR -->
<form method="GET" class="controls-bar">

    <input type="text"
           name="q"
           class="search-box"
           placeholder="Search by name or phoneâ€¦"
           value="{{ request.args.get('q','') }}">

    <input type="date"
           name="date"
           class="date-box"
           value="{{ request.args.get('date','') }}"
           onchange="this.form.submit()">

</form>

<!-- PATIENT TABLE -->
<div class="table-container">
<table class="patients-table">
    <thead>
        <tr>
            <th>ID</th>
            <th>Name</th>
            <th>Contact</th>
            <th>Issue</th>
            <th>Last Visit</th>
            <th style="text-align:center;">Actions</th>
        </tr>
    </thead>

    <tbody id="patientTable">
        {% if patients %}
            {% for p in patients %}
            <tr>
                <td>{{ p.patient_no }}</td>
                <td>
                    <div class="patient-info">
                        <img src="{{ url_for('static', filename='patient_images/' + p.image) }}" class="patient-mini">
                        <div>
                            <strong>{{ p.name }}</strong>
                            <p class="subtext">{{ p.gender }}, {{ p.age }} yrs</p>
                        </div>
                    </div>
                </td>

                <td>{{ p.phone }}</td>
                <td>{{ p.disease }}</td>
                <td>{{ p.last_visit }}</td>

                <td class="action-buttons">
                    <a href="{{ url_for('patients_bp.patient_profile', id=p.id) }}" class="btn-view">View</a>

                    <a href="{{ url_for('patients_bp.upload_record', id=p.id) }}" 
                       class="btn-upload">Record</a>

                    <a href="{{ url_for('patients_bp.generate_certificate', id=p.id) }}" 
                       class="btn-cert">Certificate</a>
                </td>
            </tr>
            {% endfor %}
        {% else %}
        <tr>
            <td colspan="6" class="empty-state">
                <img src="{{ url_for('static', filename='images/empty.png') }}" width="150">
                <p>No patients found</p>
            </td>
        </tr>
        {% endif %}
    </tbody>
</table>
</div>

<script src="{{ url_for('static', filename='js/patients/patient_search.js') }}"></script>

{% endblock %}
